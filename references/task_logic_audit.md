# Task Logic Audit: McGurk Effect Task

## 1. Paradigm Intent

- Task: `mcgurk`
- Primary construct: condition-dependent cognitive processing in `McGurk Effect Task`.
- Manipulated factors: configured trial conditions and trial-state timing.
- Dependent measures: response key/latency where applicable, hit/miss or outcome fields, and block/session summaries.
- Key citations:
  - `W2061698928`
  - `W1963926913`
  - `W2015198688`
  - `W1976571557`

## 2. Block/Trial Workflow

### Block Structure

- Total blocks: `3`
- Trials per block: `24`
- Randomization/counterbalancing: block trial conditions are generated by the task controller and consumed by `BlockUnit(...).run_trial(...)`.

### Trial State Machine

1. `cue`
   - Onset trigger(s): `congruent_cue_onset`, `incongruent_cue_onset`, `audio_only_cue_onset`
   - Stimuli shown: `{expr}_cue`
   - Valid keys: `[]`
   - Timeout behavior: bounded by configured phase duration and then auto-advance.
   - Next state: `anticipation`
2. `anticipation`
   - Onset trigger(s): `congruent_anti_onset`, `incongruent_anti_onset`, `audio_only_anti_onset`
   - Stimuli shown: `fixation`
   - Valid keys: `[]`
   - Timeout behavior: bounded by configured phase duration and then auto-advance.
   - Next state: `target`
3. `target`
   - Onset trigger(s): `congruent_target_onset`, `incongruent_target_onset`, `audio_only_target_onset`
   - Stimuli shown: `{expr}_target`
   - Valid keys: `list(response_keys)`
   - Timeout behavior: bounded by configured phase duration and then auto-advance.
   - Next state: `trial_end`

## 3. Condition Semantics

- Condition ID: `congruent`
  - Participant-facing meaning: `congruent` condition.
  - Concrete stimulus realization: cue text "线索：一致条件" with condition-linked target/feedback stages.
  - Implemented stimuli: `congruent_cue`, `congruent_target`, `congruent_hit_feedback`, `congruent_miss_feedback`, `fixation`
  - Outcome rules: computed by task controller and response logic in `src/run_trial.py`.
- Condition ID: `incongruent`
  - Participant-facing meaning: `incongruent` condition.
  - Concrete stimulus realization: cue text "线索：不一致条件" with condition-linked target/feedback stages.
  - Implemented stimuli: `incongruent_cue`, `incongruent_target`, `incongruent_hit_feedback`, `incongruent_miss_feedback`, `fixation`
  - Outcome rules: computed by task controller and response logic in `src/run_trial.py`.
- Condition ID: `audio_only`
  - Participant-facing meaning: `audio only` condition.
  - Concrete stimulus realization: cue text "线索：仅听觉条件" with condition-linked target/feedback stages.
  - Implemented stimuli: `audio_only_cue`, `audio_only_target`, `audio_only_hit_feedback`, `audio_only_miss_feedback`, `fixation`
  - Outcome rules: computed by task controller and response logic in `src/run_trial.py`.

## 4. Response and Scoring Rules

- Response mapping: configured keys `['f', 'j', 'k', 'space']`; trial response capture uses phase-specific valid key sets.
- Missing-response policy: timeout triggers are emitted where defined; timeout feedback paths are logged.
- Correctness logic: derived from controller + `target hit/miss` or decision-policy rules implemented in code.
- Reward/penalty updates: controller updates are persisted per trial and summarized at block/task end.
- Running metrics: trial records include phase-level context, condition ids, response state, and summary fields.

## 5. Stimulus Layout Plan

- Screen: instruction/block summary/final summary
  - Stimulus IDs shown together: `instruction_text`, `block_break`, `good_bye` (task-dependent).
  - Layout anchors (`pos`): centered default anchor unless explicitly overridden in config.
  - Size/spacing (`height`, `wrapWidth`): values are defined per stimulus in `config/config.yaml` and mirrored in QA/sim configs.
  - Readability checks: QA gate verifies no placeholder text and successful render path.
- Screen: trial core stimuli
  - Stimulus IDs shown together: condition cue + fixation + decision/target + feedback (phase-dependent).
  - Layout anchors (`pos`): center-screen presentation with condition-specific text assets where configured.
  - Rationale: preserves phase clarity and trigger-aligned onset logging.

## 6. Trigger Plan

| Trigger | Code | Semantics |
|---|---:|---|
| `audio_only_anti_onset` | 32 | phase event defined in task trigger map |
| `audio_only_cue_onset` | 22 | phase event defined in task trigger map |
| `audio_only_hit_fb_onset` | 74 | phase event defined in task trigger map |
| `audio_only_key_press` | 52 | phase event defined in task trigger map |
| `audio_only_miss_fb_onset` | 75 | phase event defined in task trigger map |
| `audio_only_no_response` | 62 | phase event defined in task trigger map |
| `audio_only_target_onset` | 42 | phase event defined in task trigger map |
| `block_end` | 11 | phase event defined in task trigger map |
| `block_onset` | 10 | phase event defined in task trigger map |
| `congruent_anti_onset` | 30 | phase event defined in task trigger map |
| `congruent_cue_onset` | 20 | phase event defined in task trigger map |
| `congruent_hit_fb_onset` | 70 | phase event defined in task trigger map |
| `congruent_key_press` | 50 | phase event defined in task trigger map |
| `congruent_miss_fb_onset` | 71 | phase event defined in task trigger map |
| `congruent_no_response` | 60 | phase event defined in task trigger map |
| `congruent_target_onset` | 40 | phase event defined in task trigger map |
| `exp_end` | 2 | phase event defined in task trigger map |
| `exp_onset` | 1 | phase event defined in task trigger map |
| `incongruent_anti_onset` | 31 | phase event defined in task trigger map |
| `incongruent_cue_onset` | 21 | phase event defined in task trigger map |
| `incongruent_hit_fb_onset` | 72 | phase event defined in task trigger map |
| `incongruent_key_press` | 51 | phase event defined in task trigger map |
| `incongruent_miss_fb_onset` | 73 | phase event defined in task trigger map |
| `incongruent_no_response` | 61 | phase event defined in task trigger map |
| `incongruent_target_onset` | 41 | phase event defined in task trigger map |

## 7. Inference Log

- Decision: selected-paper set was curated after OpenAlex retrieval to keep task-relevant, high-citation open-access evidence.
- Why inference was required: OpenAlex keyword search can include semantically broad false positives for short task names.
- Citation-supported rationale: final evidence IDs in `references/references.yaml` are mapped in parameter and stimulus artifacts.
- Decision: phase-level descriptions are derived from `set_trial_context(...)` instrumentation in `src/run_trial.py`.
- Why inference was required: literature describes paradigms conceptually while implementation requires explicit state-machine naming.
- Citation-supported rationale: state machine preserves citation-aligned condition factors and timing structure.
